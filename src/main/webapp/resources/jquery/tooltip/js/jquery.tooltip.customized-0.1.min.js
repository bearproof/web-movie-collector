(function(a){a.extend(a.fn,{tooltip:function(b){var c={arrowHPosX:"dinamic",animate:0,displaytype:"fade",displaytime:100,arrowUp:"<div class='tooltip-arrow-up'></div>",arrowDown:"<div class='tooltip-arrow-down'></div>",footerTmpl:"<p class='tooltip-footer'>{footer}</p>",bodyTmpl:"<p>{msg}</p>",headTmpl:"<p class='tooltip-head'>{title}</p>",htmlTmpl:"<div class='tooltip hidden {id}' id='{id}'><div class='tooltip-content'>{head}<div class='tooltip-body'>{body}</div>{footer}</div></div>",title:"",msg:null,footer:""},d=a.extend({},c,b),e=function(a,b){var d,c=a;for(d in b)b.hasOwnProperty(d)&&(c=c.replace(RegExp("{"+d+"}","g"),b[d]));return c},f=function(b,c){var i,f="",g=d.msg,h=[];return d.msg?a.isFunction(d.msg)&&(g=d.msg()):g=c.data("tooltipmsg"),a.isArray(g)?(g=[],h=[],a.each(g,function(b,c){a.isPlainObject(c)?h.push(e(d.bodyTmpl,c)):h.push(e(d.bodyTmpl,{msg:c}))}),f=h.join("")):f=a.isPlainObject(g)?e(d.bodyTmpl,g):e(d.bodyTmpl,{msg:g}),i=a(e(d.htmlTmpl,{id:b,head:/^\s*$/.test(d.title)?"":e(d.headTmpl,{title:d.title}),body:g,footer:/^\s*$/.test(d.footer)?"":e(d.footerTmpl,{footer:d.footer})}))},g=function(a,b){var c=a.html();return"up"===b.arrowPos?a.html(d.arrowUp+c):"down"===b.arrowPos&&a.html(c+d.arrowDown),a.find("[class^=tooltip-arrow]").css({"background-position":b.arrowOffsetLeft+" "+b.arrowOffsetTop}),a},h=function(b,c,e){var j,f=b.offset(),g=0>e.pageX-40?0:e.pageX-40+c.width()>a(window).width()?a(window).width()-c.width():e.pageX-40,h=e.pageX-g-10,i={top:f.top-c.height()-10<a(document).scrollTop()?f.top+b.height()+10+d.animate:f.top-c.height()-10-d.animate,left:g,arrowPos:f.top-c.height()-10<a(document).scrollTop()?"up":"down",arrowOffsetLeft:(c.width()-h-10<Math.round(c.width()/2)?Math.round(h/2):h)+"px",arrowOffsetTop:f.top-c.height()-10<a(document).scrollTop()?"-70px":"top"};return("center"===d.arrowHPosX||h+10>=c.width())&&(i.arrowOffsetLeft="center",j=e.pageX-Math.round(c.width()/2),i.left=0>j?0:j+c.width()>a(window).width()?a(window).width()-c.width():j),i},i=function(b,c){c.hideTimeOut=[],0!==c.clearOutTime&&(c.displayed=0),c.clearOutTime=0,b.fadeOut("fast",function(){a(this).remove()})},j=function(){a("[id^=tooltip]").remove()};return this.each(function(){var b=a(this),c={displayed:"",clearOutTime:0,showTimeOut:{},hideTimeOut:{}};b.data({tooltipid:"tooltip_"+Math.floor(1e4*Math.random())}),b.mouseover(function(e){var j=a(this),k=j.data("tooltipid");a("."+k).is(":visible")?(clearTimeout(c.clearOutTime),c.clearOutTime=0):(c.displayed=k,c.showTimeOut[c.displayed]=setTimeout(function(){var p,q,r,s,l=f(k,b),m={tag:"ul","class":"tooltipContent",children:[{tag:"li","class":"delimiter",html:""},{tag:"li","class":"tooltip-movie-info",html:"${title}"},{tag:"li","class":"tooltip-movie-info",html:"${year}"},{tag:"li","class":"tooltip-movie-info",html:"${director}"},{tag:"li","class":"tooltip-movie-info",html:'<a class="tooltip-movie-id" href="#">${id}</a>'}]},n={},o=b.data("tooltipmsg");a("body").append(l),console.log("tooltip added to body");for(p in o)o.hasOwnProperty(p)&&(q=o[p].site,q in n||(n[q]=[]),r=n[q],r.push(o[p]));for(p in n)n.hasOwnProperty(p)&&(a(".tooltip-body").append('<div class="'+p+" site"+'"/>'),a("."+p).append('<p class="tooltip-header">'+p.toUpperCase()+"</p>"),a("."+p).json2html(n[p],m));console.log("json2html done"),s=h(j,l,e),l.css({left:s.left,top:s.top}),l=g(l,s),c.hideTimeOut[c.displayed]=!0,c.clearOutTime=0,"fade"===d.displaytype?l.fadeIn(d.displaytime).animate({top:"up"===s.arrowPos?"-="+d.animate+"px":"+="+d.animate+"px"},{duration:"slow",queue:!1}).mouseover(function(){clearTimeout(c.clearOutTime)}):l.show(d.displaytime),l.mouseout(function(){c.clearOutTime=setTimeout(function(){i(l,c)},250)}).click(function(){i(l,c)})},200))}).mouseout(function(){var d=a(this),e=d.data("tooltipid"),f=a("."+e);clearTimeout(c.showTimeOut[e]),c.hideTimeOut[c.displayed]?c.clearOutTime=setTimeout(function(){i(f,c)},200):(c.clearOutTime=0,c.displayed="")}),a(".scrollable").scroll(function(){j()}),a(window).scroll(function(){j()})})}})})(jQuery);